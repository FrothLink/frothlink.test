import {rooms} from './station.js'
document.addEventListener('DOMContentLoaded', function() {
    const userInput = document.getElementById('userInput');
    const output = document.querySelector('.output');
    const terminalBody = document.querySelector('.terminal-body');

    
    /*
    =========================================================
    |.......................................................|
    |........IF YOU'RE HERE YOU'RE RUINING THE GAME.........|
    |.........LET PEOPLE HAVE FUN, DON'T LEAK SHIT..........|
    |.......................................................|
    =========================================================
    //also yeah my code sucks ass i have no idea what i'm doing
    
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⡷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⡿⠋⠈⠻⣮⣳⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⡿⠋⠀⠀⠀⠀⠙⣿⣿⣤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣶⣿⡿⠟⠛⠉⠀⠀⠀⠀⠀⠀⠀⠈⠛⠛⠿⠿⣿⣷⣶⣤⣄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣾⡿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠛⠻⠿⣿⣶⣦⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⣀⣠⣤⣤⣀⡀⠀⠀⣀⣴⣿⡿⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠿⣿⣷⣦⣄⡀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣄⠀⠀
⢀⣤⣾⡿⠟⠛⠛⢿⣿⣶⣾⣿⠟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠿⣿⣷⣦⣀⣀⣤⣶⣿⡿⠿⢿⣿⡀⠀
⣿⣿⠏⠀⢰⡆⠀⠀⠉⢿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⢿⡿⠟⠋⠁  ⠀⠀⢸⣿⠇⠀
⣿⡟⠀⣀⠈⣀⡀⠒⠃⠀⠙⣿⡆⠀⠀⠀⠀⠀⠀⠀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀  ⠀⠀⠀⢸⣿⠇⠀
⣿⡇⠀⠛⢠⡋⢙⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀  ⠀⠀⠀⣿⣿⠀⠀
⣿⣧⠀⠀⠀⠓⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⠋⠀⠀⢸⣧⣤⣤⣶⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⡿⠀⠀
⣿⣿⣤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠻⣷⣶⣶⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⠁⠀⠀
⠈⠛⠻⠿⢿⣿⣷⣶⣦⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⡏⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠻⠿⢿⣿⣷⣶⣦⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠿⠛⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢿⣿⡄⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠙⠛⠻⠿⢿⣿⣷⣶⣦⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⡄⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠛⠛⠿⠿⣿⣷⣶⣶⣤⣤⣀⡀⠀⠀⠀⢀⣴⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⡿⣄
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠛⠛⠿⠿⣿⣷⣶⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀  ⠀⠀⠈⣿⣹
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⠀⠀⠀⠀ ⠀  ⠀⢸⣧
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣆⠀⠀⠀⠀⠀⠀⢀⣀⣠⣤⣶⣾⣿⣿⣿⣿⣤⣄⣀⡀⠀  ⠀⣿
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⢿⣻⣷⣶⣾⣿⣿⡿⢯⣛⣛⡋⠁⠀⠀⠉⠙⠛⠛⠿⣿⣿⡷⣶⣿
    */

/*
    NOTES OF THINGS I'D LIKE TO DO/NEED TO DO
    - figure out how to have a command like 'say' followed by some text and use that properly
    - maybe make it so numpad keys work for directions?
    - maybe try to figure ou hyperlink buttons like gs4 has?
*/

    //putting this out here so it can be set in multiple functions
    let response = '';
    let typeSpeed = 0;
    let moveDir = ''
    let currentRoom = ''

    // Function to focus on userInput field
    function focusUserInput() {
        userInput.focus();
    }

    // Initial focus on page load
    focusUserInput();

    userInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            const command = userInput.value.trim();
            response = processCommand(command);
            if (command) {
                // Create a new div element for the command entered
                const commandOutput = document.createElement('div');
                commandOutput.classList.add('command-line');
                output.appendChild(commandOutput); // Append command to output
            }
            userInput.value = '';
            focusUserInput(); // Keep focus on input field after enter
            if (response) {
                const typedCommand = document.createElement('div');
                let addCarat = `> ` + command
                typedCommand.classList.add('response-line');
                output.appendChild(typedCommand); // Append response to output
                animateTypeOut(typedCommand, addCarat); // Trigger typing animation for response

                // Create a new div element for the response
                const responseOutput = document.createElement('div');
                responseOutput.classList.add('response-line');
                output.appendChild(responseOutput); // Append response to output
                animateTypeOut(responseOutput, response); // Trigger typing animation for response
            }
        }
    });

    function processCommand(command) {
        const cmd = command.toLowerCase();
            
        // Handle different commands
        switch (cmd) {
            case 'n':
            case 'north':
                moveDir = 'n'
                return SearchDir(currentRoom, moveDir)
            case 'ne':
            case 'northeast':
                moveDir = 'ne'
                return SearchDir(currentRoom, moveDir)
            case 'e':
            case 'east':
                moveDir = 'e'
                return SearchDir(currentRoom, moveDir)
            case 'se':
            case 'southeast':
                moveDir = 'se'
                return SearchDir(currentRoom, moveDir)
            case 's':
            case 'south':
                moveDir = 's'
                return SearchDir(currentRoom, moveDir)
            case 'sw':
            case 'southwest':
                moveDir = 'sw'
                return SearchDir(currentRoom, moveDir)
            case 'w':
            case 'west':
                moveDir = 'w'
                return SearchDir(currentRoom, moveDir)
            case 'nw':
            case 'northwest':
                moveDir = 'nw'
                return SearchDir(currentRoom, moveDir)
            case 'look':
                return Look(currentRoom)
            case 'clear':
                clearTerminal();
                return ''; // Return empty string after clearing terminal
            case '':
                return ''; // Handle empty input gracefully
            default:    
                switch(cmd.split(" ")[0]) {
                    case 'say':
                        //this needs to also send to the server for other players to recieve
                        return `you say "${command.substr(command.indexOf(" ") + 1)}"`
                    case 'whisper':
                        //this needs to be changed to send specifically to specified character
                        const whisper = command.substr(command.indexOf(" ") + 1)
                        return `you whisper to ${whisper.split(" ")[0]}: "${whisper.substr(whisper.indexOf(" ") + 1)}"`
                    case 'message':
                        //this needs to be changed to send specifically to specified user
                        const message = command.substr(command.indexOf(" ") + 1)
                        return `you message ${message.split(" ")[0]}: "${message.substr(message.indexOf(" ") + 1)}"`
                    case 'go':
                        processCommand(command.substr(command.indexOf(" ") + 1))
                        //the return here is behaving strangely, figure out how to fix
                        return ``
                    default:
                        return `COMMAND "${command}" NOT RECOGNIZED`;
                }
        }
    }

    function clearTerminal() {
        output.innerHTML = ''; // Clear the output content
        // Scroll to the top after clearing
        terminalBody.scrollTop = 0;
    }

    // Ensure userInput remains focused when clicking away
    document.addEventListener('click', function(event) {
        if (!userInput.contains(event.target)) {
            focusUserInput();
        }
    });

    function animateTypeOut(element, text) {
        element.innerHTML = ''; // Clear existing text
        let i = 0;
        if (text == undefined){
            text = ''
        }
        function type() {
            if (i < text.length) {
                let currentChar = text.charAt(i);
                if (currentChar === '<') {
                    const endTagIndex = text.indexOf('>', i);
                    if (endTagIndex !== -1) {
                        element.innerHTML += text.substring(i, endTagIndex + 1);
                        i = endTagIndex + 1;
                    }
                } else {
                    element.innerHTML += currentChar;
                    i++;
                }
                setTimeout(type, typeSpeed);//adjust typing speed here
            }
        }

        type();
    }

    function SearchDir (roomNow, direction) {

        let roomObj = ''
        let toRoom = ''
        let newRoom = ''
        let x = rooms
        roomObj = x[roomNow];
        toRoom = roomObj[direction];
        if (toRoom === undefined) {
            response = `you can't go this direction`
            makeElement()
        }
        else {
        newRoom = x[toRoom];
        RoomSwitch(newRoom)
        }

    }

    function Look (roomNow){
        let x = rooms[roomNow]
        if (x.look === undefined) {
            response = `you don't need to look closer right now`
            makeElement()
        }
        else {
            response = x.look
            makeElement()
        }
    }

    function RoomSwitch (room) {

        currentRoom = room.id
        //create header div for new room
        //[PLACEHOLDER vv]
        response = room.name
        makeHeader()
        //[PLACEHOLDER ^^]

        //write room description
        response = room.description
        makeElement()

        //Say available directions
        //find a better way to do this
        let canMove = 'Obvious Paths:'
        if (room.n != undefined) {
            canMove += ' north,'
        }
        if (room.ne != undefined) {
            canMove += ' northeast,'
        }
        if (room.e != undefined) {
            canMove += ' east,'
        }
        if (room.se != undefined) {
            canMove += ' southeast,'
        }
        if (room.s != undefined) {
            canMove += ' south,'
        }
        if (room.sw != undefined) {
            canMove += ' southwest,'
        }
        if (room.w != undefined) {
            canMove += ' west,'
        }
        if (room.nw != undefined) {
            canMove += ' northwest,'
        }
        canMove = canMove.slice(0, -1)
        response = canMove
        makeElement()

    }

    function makeElement() {
        // Create a new div element for the response
        const responseOutput = document.createElement('div');
        responseOutput.classList.add('response-line');
        output.appendChild(responseOutput); // Append response to output
        animateTypeOut(responseOutput, response); // Trigger typing animation for response
    }

    function makeHeader() {
        // Create a new div element for the response
        const responseOutput = document.createElement('div');
        responseOutput.style.backgroundColor = "#2f2f2f"
        responseOutput.style.width = "600px" //try to make this snap to window width rather than using pixel size
        responseOutput.classList.add('response-line');
        output.appendChild(responseOutput); // Append response to output
        animateTypeOut(responseOutput, response); // Trigger typing animation for response
    }

    function Startup () {

        let x = rooms
        currentRoom = rooms.test1
        
        if (currentRoom === undefined) {
            //make new savedPosition on the json for the player next 
            currentRoom = 'test1'
        }

        RoomSwitch(currentRoom)
    }
    //I'm going to need to change how i do this. I'll be getting a bunch of info in one function called before this one then I'll call this in that function probably?
    Startup() //have to update this and the function when implementing saving player info
});